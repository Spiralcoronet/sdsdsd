<head>
	<!-- Global site tag (gtag.js) - Google Analytics -->
	<script async src="https://www.googletagmanager.com/gtag/js?id=UA-111680959-1"></script>
	<script type="text/javascript" src="JsScripts/jsCalc.js"></script>
	<script type="text/javascript" src="JsScripts/alt1lib.js"></script>
	<script type="text/javascript" src="JsScripts/runeappslib.js"></script>
	<script type="text/javascript" src="JsScripts/imagedetect.js"></script>
	<script type="text/javascript" src="JsScripts/xpcounter.js"></script>
	<link rel="stylesheet" type="text/css" href="nis/nis.css"/>
	<link rel="stylesheet" type="text/css" href="alt1-currentskin/skinstyle.css"/>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
	<script>		
		<!-- Google Analytics -->
		(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
		(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
		m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
		})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

		ga('create', 'UA-111680959-1', 'auto');
		ga('send', 'pageview');
		<!-- End Google Analytics -->
		
		var reader = new XpcounterReader();
		var findfails = 0;
		var hist = {};
		
		// ==========================================================
		// Hides content and begins tick intervals
		// ==========================================================
		function start()
		{
			// Lets hide the training div when the page loads
			document.getElementById('trainingPage').style.display = 'none'; 
			
			// For whatever reason this fixes a bug where txtCurrXp 
			// keeps going blank upon gaining xp until you click on train button and go back
			document.getElementById("xpHeader").value = document.getElementById("txtCurrXp").value; 
			
			startFindCounter();
			setInterval(tick, 1000);
			tick();
		}
		
		// ==========================================================
		// Searches for xp counter
		// ==========================================================
		function startFindCounter()
		{
			if (!reader.searching) { reader.pos = null;}
			reader.findAsync(function () {
				reader.read();
				var found = false;
				for (var a in reader.skills) { if (reader.values[a] > 0) { found = true; } }
				if (!found) { reader.pos = null; }

				if (!reader.pos) { findfails++; if (findfails >= 2) { findcounterError(); } }
				else { findfails = 0; }

				if (reader.pos) { reader.showPosition();}
				if (reader.rounded) { xpcounterRoundError();}
				
				tick();
				
			});
			tick();
		}
		
		// ==========================================================
		// Self explanatory I think
		// ==========================================================
		function tick() 
		{
			//if (!reader.searching) {startFindCounter();} // Used for debugging when finding xp counter
			reader.read();
			for (var a = 0; a < reader.skills.length; a++) {
				if (!reader.skills[a]) { continue; }
				if (reader.values[a] == -1) { continue; }
				skillread(reader.skills[a], reader.values[a]);
			}
		}
		
		// ==========================================================
		// Grabs how much xp you gained during tick and does needed updates
		// ==========================================================
		function skillread(skill, xp)
		{
			if (!hist[skill])
			{
				hist[skill]  = {skill , xp};
			}
			if(document.getElementById('skill').value == hist[skill].skill)
			{
				if(hist[skill].xp < xp || xp == 0)
				{
					//console.log(parseInt(hist[skill].xp) + " : " + parseInt(xp - hist[skill].xp));
					currXp = document.getElementById("xpHeader").value;
					document.getElementById("xpHeader").value = parseInt(currXp) + (parseInt(xp) - parseInt(hist[skill].xp));
					document.getElementById("txtCurrXp").value = parseInt(currXp) + (parseInt(xp) - parseInt(hist[skill].xp));
					hist[skill].xp = xp;
					update();
				}
			}
		}
		
		// ==========================================================
		// When a skill is selected from the dropdown populate
		// necessary dropdowns and values
		// ==========================================================
		function skillSelect(skill)
		{
			populateMethod(skill);
			popCategoryDropDown();
			popMethodDropdown('All Items');
		}
	</script>
</head>
<body class="nis" onLoad="start();" >
	<div id="main" onLoad=""> <!-- calculate(document.getElementById('category').value); -->
		
		<div style="padding-top: 10px;">
			<!-- Select a skill -->
			<label class="nistext" >Skill: </label>
			<select class="nisdropdown" id='skill' onChange="skillSelect(document.getElementById('skill').value);"> <!-- populateMethod(document.getElementById('skill').value); popMethodDropdown('All Items'); popCategoryDropDown(); -->
				<option selected value=""></option>
				<option value="agi">Agility</option>
				<option value="con">Construction</option>
				<option value="coo">Cooking</option>
				<option value="cra">Crafting</option>
				<option value="div">Divination</option>
				<option value="far">Farming</option>
				<option value="fir">Firemaking</option>
				<option value="fis">Fishing</option>
				<option value="fle">Fletching</option>
				<option value="her">Herblore</option>
				<option value="hun">Hunter</option>
				<option value="mag">Magic</option>
				<option value="min">Mining</option>
				<option value="pra">Prayer</option>
				<option value="run">Runecrafting</option>
				<option value="smi">Smithing</option>
				<option value="sum">Summoning</option>
				<option value="thi">Thieving</option>
				<option value="woo">Woodcutting</option>
			</select>
		</div>
		
		<div>
			<!-- Type in current skill xp -->
			<label class="nistext">Current Xp: </label> 
			<input class="nisinput nistext" type="number" id="txtCurrXp" value="1" onblur="calculate(document.getElementById('category').value);"/>
		</div>
		
		<div>
		<!-- Type in either goal for xp or level -->
			<select class="nisdropdown" id="option" onChange="calculate(document.getElementById('category').value);">
				<option selected value="level">Target Level</option>
				<option value="xp">Target XP</option>
			</select>
			<input class="nisinput nistext" type="number" id="txtTarget" value="99" onblur="calculate(document.getElementById('category').value);"/>
			</br>
		</div>
		
		<!-- Helper divs to populate needed content -->
		<!-- Categories Section -->
		<div id="popCategories">
			<label class="nistext">Category: </label>
			<select class="nisdropdown nistext" id="category" onChange="loadTable(document.getElementById('category').value); popMethodDropdown(document.getElementById('category').value);"></select>
		</div>
		
		<!-- Multiplier Section -->
		<div>
			<label class="nistext">Multiplier: </label>
			<input class="nisinput nistext" type="number" id="txtMultiplier" style="width: 50px" value="0" onchange="loadTable(document.getElementById('category').value);" />
			<label class="nistext">%</label>
		</div>
		
		<!-- Methods Section -->
		<div id="popMethods">
			<label class="nistext">Method: </label>
			<select class="nisdropdown" id="methodDropdown"></select>
			<div><button class='nisbutton' type='button' onClick='showTrainingDiv();'>Train!</button></div>
		</div>
		
		<!-- Table Section -->
		<div id="popTable"></div>
	</div>
	
	<!-- Compacted version of row from table for training -->
	<div id="trainingPage">
		<div><input class="nisinput nistext"id="xpHeader" onchange="update()"/></div>
		<div><label class="nistext" id="actionsHeader"></label></div>
		<div><button class="nisbutton" type="button" onclick="showFullSite();">Table</button></div>
	</div>
</body>
